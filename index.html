<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MR Detailing Academy</title>

  <style>
    :root{
      --bg:#0b0d12;
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.52);
      --p1:rgba(155,124,255,.90);
      --p2:rgba(51,214,166,.75);
      --shadow: 0 18px 40px rgba(0,0,0,.38);
      --r16:16px;
      --r18:18px;
      --r22:22px;
      --pad:16px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      background: radial-gradient(1200px 700px at 10% 10%, rgba(155,124,255,.22), transparent 55%),
                  radial-gradient(1000px 650px at 90% 70%, rgba(51,214,166,.14), transparent 60%),
                  var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }

    /* ====== layout ====== */
    .app{
      max-width: 980px;
      margin: 0 auto;
      padding: 16px 16px 92px;
    }

    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding-top:4px;
    }

    .topbar__left{
      display:flex;
      gap:12px;
      align-items:flex-start;
    }

    .xbtn{
      width:34px;height:34px;border-radius:12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--text);
      display:grid; place-items:center;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
    }

    .hello{
      line-height:1.1;
    }
    .hello .muted{ color:var(--muted); font-size:13px; }
    .hello .name{ font-size:28px; font-weight:900; letter-spacing:.2px; }

    .topbar__right{
      text-align:right;
      line-height:1.1;
    }
    .topbar__right .muted{ color:var(--muted); font-size:12px; }
    .topbar__right .bal{ font-size:18px; font-weight:800; }

    .sectionTitle{
      margin:18px 0 10px;
      font-size:18px;
      font-weight:900;
      letter-spacing:.2px;
    }

    /* ====== glass cards ====== */
    .glass{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--r18);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
    }
    .hr{
      height:1px;
      background: rgba(255,255,255,.10);
      margin: 12px 0;
    }
    .muted{ color:var(--muted); }
    .muted2{ color:var(--muted2); }
    .small{ font-size:12px; }

    /* ====== horizontal sections cards ====== */
    .hscroll{
      display:flex;
      gap:12px;
      overflow:auto;
      padding-bottom:6px;
      -webkit-overflow-scrolling:touch;
    }
    .hscroll::-webkit-scrollbar{ height:0; }

    .mini{
      min-width: 188px;
      padding: 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      box-shadow: 0 16px 36px rgba(0,0,0,.35);
      backdrop-filter: blur(12px);
      color:var(--text);
      cursor:pointer;
      text-align:left;
      position:relative;
      overflow:hidden;
    }
    .mini:active{ transform: translateY(1px); }

    .mini::before{
      content:"";
      position:absolute; inset:-40px;
      background:
        radial-gradient(500px 160px at 18% 28%, rgba(155,124,255,.26), transparent 60%),
        radial-gradient(500px 160px at 86% 70%, rgba(51,214,166,.14), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.40));
      pointer-events:none;
    }

    .mini__top{
      display:flex;
      justify-content:flex-end;
      position:relative;
      z-index:1;
    }
    .mini__pill{
      font-size:11px;
      font-weight:800;
      letter-spacing:.6px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
    }
    .mini__iconWrap{
      position:relative; z-index:1;
      margin-top:10px;
      width:54px;height:54px;
      border-radius:16px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:
        0 18px 40px rgba(0,0,0,.35),
        0 0 0 1px rgba(155,124,255,.16) inset;
      backdrop-filter: blur(10px);
    }
    .mini__icon{
      width:28px;height:28px;
      color: rgba(255,255,255,.90);
      filter: drop-shadow(0 10px 20px rgba(155,124,255,.18));
    }
    .mini__icon svg{ width:100%; height:100%; display:block; }
    .mini__icon svg *{ stroke-width: 1.6 !important; }

    .mini__title{
      position:relative; z-index:1;
      margin-top:10px;
      font-weight:900;
      font-size:16px;
    }
    .mini__sub{
      position:relative; z-index:1;
      margin-top:2px;
      font-size:12px;
      color:var(--muted);
    }
    .mini.premium .mini__iconWrap{
      box-shadow:
        0 18px 40px rgba(0,0,0,.35),
        0 0 0 1px rgba(155,124,255,.28) inset,
        0 0 28px rgba(155,124,255,.16);
    }

    /* ====== hero course cards (Home) ====== */
    .heroCard{
      position:relative;
      overflow:hidden;
      border-radius: 20px;
      padding: 16px;
      margin-top:12px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
    }
    .heroCard::before{
      content:"";
      position:absolute; inset:-50px;
      background:
        radial-gradient(800px 220px at 14% 28%, rgba(155,124,255,.28), transparent 60%),
        radial-gradient(760px 220px at 90% 70%, rgba(51,214,166,.14), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.55));
      pointer-events:none;
    }
    .heroRow{
      position:relative;
      z-index:1;
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      font-weight:900;
      letter-spacing:.4px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
    }
    .heroTitle{
      margin-top:10px;
      font-size:22px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .heroDesc{
      margin-top:6px;
      font-size:13px;
      color:var(--muted);
      line-height:1.35;
      max-width: 520px;
    }
    .heroActions{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    /* ====== buttons ====== */
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding: 11px 14px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:900;
      line-height:1;
      min-height:42px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .btn--primary{
      background: linear-gradient(90deg, rgba(155,124,255,.95), rgba(51,214,166,.70));
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 18px 40px rgba(155,124,255,.16);
    }
    .btn--ghost{
      background: rgba(255,255,255,.04);
    }

    /* ====== course list cards ====== */
    .courseCard{
      position:relative;
      overflow:hidden;
      padding:16px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      margin-top:12px;
    }
    .courseCard::before{
      content:"";
      position:absolute; inset:-50px;
      background:
        radial-gradient(760px 220px at 15% 30%, rgba(155,124,255,.26), transparent 60%),
        radial-gradient(760px 220px at 90% 70%, rgba(51,214,166,.14), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.60));
      pointer-events:none;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      position:relative;
      z-index:1;
    }
    .badge.ok{ box-shadow: 0 0 0 1px rgba(51,214,166,.18) inset; }
    .badge.lock{ box-shadow: 0 0 0 1px rgba(155,124,255,.20) inset; }

    .courseTitle{ position:relative; z-index:1; margin:10px 0 0; font-weight:950; font-size:20px; }
    .courseDesc{ position:relative; z-index:1; margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.35; max-width: 560px; }

    .progressLine{
      position:relative; z-index:1;
      margin-top:12px;
      height:8px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
      max-width: 520px;
    }
    .progressLine > i{
      display:block;
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(155,124,255,.95), rgba(51,214,166,.75));
      box-shadow: 0 10px 18px rgba(155,124,255,.20);
    }

    .courseActions{
      position:relative; z-index:1;
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      max-width: 520px;
    }
    .courseActions .btn{
      width:100%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    @media (max-width: 360px){
      .courseActions{ grid-template-columns: 1fr; }
    }

    .rightIcon{
      position:absolute;
      right:18px;
      top:50%;
      transform: translateY(-50%);
      width:66px;height:66px;
      border-radius:18px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
      box-shadow:
        0 18px 40px rgba(0,0,0,.28),
        0 0 0 1px rgba(155,124,255,.16) inset;
      color: rgba(255,255,255,.86);
      pointer-events:none;
      z-index:1;
    }
    .rightIcon svg{ width:34px;height:34px; }
    .courseCard.free .rightIcon{ box-shadow: 0 0 0 1px rgba(51,214,166,.18) inset, 0 18px 40px rgba(0,0,0,.28); }
    .courseCard.locked .rightIcon{ box-shadow: 0 0 0 1px rgba(155,124,255,.22) inset, 0 18px 40px rgba(0,0,0,.28); }

    /* ====== screens ====== */
    .screen{ display:none; }
    .screen.is-active{ display:block; }

    /* ====== bottom nav ====== */
    .nav{
      position: fixed;
      left:0; right:0; bottom:0;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: rgba(10,12,16,.78);
      backdrop-filter: blur(14px);
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex;
      justify-content:center;
      z-index:999;
    }
    .navInner{
      width:min(980px, 100%);
      display:flex;
      gap:10px;
      justify-content:space-between;
    }
    .nav__item{
      flex:1;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.78);
      padding: 10px 10px;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      font-weight:900;
      font-size:11px;
    }
    .nav__item svg{ width:20px;height:20px; }
    .nav__item.is-active{
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.94);
      box-shadow: 0 0 0 1px rgba(155,124,255,.18) inset;
    }

    /* simple list items */
    .item{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding: 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="topbar__left">
        <button class="xbtn" id="closeBtn">‚úï</button>
        <div class="hello">
          <div class="muted" id="greeting">–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ,</div>
          <div class="name" id="username">MarkeyG</div>
        </div>
      </div>

      <div class="topbar__right">
        <div class="muted">–ë–∞–ª–∞–Ω—Å</div>
        <div class="bal"><span id="balanceVal">100</span> ‚≠ê</div>
      </div>
    </div>

    <!-- HOME -->
    <section class="screen is-active" id="screen-home">
      <div class="sectionTitle">–†–∞–∑–¥–µ–ª—ã</div>

      <div class="hscroll sections">
        <button class="mini" data-go="courses">
          <div class="mini__top"><span class="mini__pill">START</span></div>
          <div class="mini__iconWrap"><div class="mini__icon">
            <svg viewBox="0 0 64 64" fill="none">
              <rect x="10" y="14" width="44" height="36" rx="6" stroke="currentColor"/>
              <path d="M18 24h28M18 32h28M18 40h18" stroke="currentColor" stroke-linecap="round"/>
            </svg>
          </div></div>
          <div class="mini__title">–ö—É—Ä—Å—ã</div>
          <div class="mini__sub">–º–æ–¥—É–ª–∏ / —É—Ä–æ–∫–∏</div>
        </button>

        <button class="mini" data-go="progress">
          <div class="mini__top"><span class="mini__pill">LIVE</span></div>
          <div class="mini__iconWrap"><div class="mini__icon">
            <svg viewBox="0 0 64 64" fill="none">
              <circle cx="32" cy="32" r="18" stroke="currentColor"/>
              <path d="M32 20v12l8 6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div></div>
          <div class="mini__title">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
          <div class="mini__sub">–ø—Ä–æ—Ü–µ–Ω—Ç—ã / —Å—Ç–∞—Ç—É—Å</div>
        </button>

        <button class="mini" data-go="bonus">
          <div class="mini__top"><span class="mini__pill">HOT</span></div>
          <div class="mini__iconWrap"><div class="mini__icon">
            <svg viewBox="0 0 64 64" fill="none">
              <path d="M32 10l6 12 14 2-10 10 2 14-12-6-12 6 2-14-10-10 14-2 6-12z"
                    stroke="currentColor" stroke-linejoin="round"/>
            </svg>
          </div></div>
          <div class="mini__title">–ë–æ–Ω—É—Å—ã</div>
          <div class="mini__sub">—Ä–µ—Ñ–µ—Ä–∞–ª—ã / —Å–∫–∏–¥–∫–∏</div>
        </button>

        <button class="mini premium" data-go="support">
          <div class="mini__top"><span class="mini__pill">PRO</span></div>
          <div class="mini__iconWrap"><div class="mini__icon">
            <svg viewBox="0 0 64 64" fill="none">
              <path d="M12 18h40v24H22l-10 8v-8H12V18z" stroke="currentColor" stroke-linejoin="round"/>
              <circle cx="26" cy="30" r="2" fill="currentColor"/>
              <circle cx="32" cy="30" r="2" fill="currentColor"/>
              <circle cx="38" cy="30" r="2" fill="currentColor"/>
            </svg>
          </div></div>
          <div class="mini__title">–°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ</div>
          <div class="mini__sub">—á–∞—Ç—ã / –ø–æ–º–æ—â—å</div>
        </button>

        <button class="mini" data-go="profile">
          <div class="mini__top"><span class="mini__pill">ME</span></div>
          <div class="mini__iconWrap"><div class="mini__icon">
            <svg viewBox="0 0 64 64" fill="none">
              <circle cx="32" cy="24" r="8" stroke="currentColor"/>
              <path d="M16 46c0-8 32-8 32 0" stroke="currentColor" stroke-linecap="round"/>
            </svg>
          </div></div>
          <div class="mini__title">–ü—Ä–æ—Ñ–∏–ª—å</div>
          <div class="mini__sub">–Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </button>
      </div>

      <div class="sectionTitle">MR Academy</div>

      <!-- FREE hero -->
      <div class="heroCard">
        <div class="heroRow">
          <div>
            <span class="pill">FREE ‚Ä¢ –±–∞–∑–∞</span>
            <div class="heroTitle">–ö—É—Ä—Å –º–æ–π–∫–∏</div>
            <div class="heroDesc">–ë–∞–∑–∞, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–ª–∞—Ç–Ω—ã–º –∫—É—Ä—Å–∞–º. –ü—Ä–æ–π–¥–∏ –º–æ–¥—É–ª–∏ –∏ —Å–¥–∞–π –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ—Å—Ç—ã.</div>
            <div class="heroActions">
              <button class="btn btn--primary" id="homeStartWash">–ù–∞—á–∞—Ç—å</button>
              <button class="btn btn--ghost" id="homeAllCourses">–í—Å–µ –∫—É—Ä—Å—ã</button>
            </div>
          </div>
          <div class="rightIcon" aria-hidden="true">
            <svg viewBox="0 0 64 64" fill="none">
              <path d="M12 38h40l-4 10H16l-4-10z" stroke="currentColor"/>
              <path d="M18 38l6-14h16l6 14" stroke="currentColor"/>
              <path d="M24 18c0 4-4 6-4 10" stroke="currentColor" stroke-linecap="round"/>
              <path d="M40 18c0 4 4 6 4 10" stroke="currentColor" stroke-linecap="round"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- LOCKED hero -->
      <div class="heroCard">
        <div class="heroRow">
          <div>
            <span class="pill">LOCKED ‚Ä¢ PRO</span>
            <div class="heroTitle">–•–∏–º—á–∏—Å—Ç–∫–∞ —Å–∞–ª–æ–Ω–∞</div>
            <div class="heroDesc">–ü–æ–∫—É–ø–∫–∞/–ø–æ–¥–ø–∏—Å–∫–∞. ‚Äì50% –∑–∞ 3 –¥—Ä—É–∑–µ–π. –î–æ—Å—Ç—É–ø –æ—Ç–∫—Ä–æ–µ–º —á–µ—Ä–µ–∑ Stars (—Å–¥–µ–ª–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º).</div>
            <div class="heroActions">
              <button class="btn btn--ghost" id="homeGoCourses">–°–ø–∏—Å–æ–∫</button>
              <button class="btn btn--ghost" id="homeGoBonus">–°–∫–∏–¥–∫–∞</button>
            </div>
          </div>
          <div class="rightIcon" aria-hidden="true">
            <svg viewBox="0 0 64 64" fill="none">
              <rect x="18" y="14" width="28" height="30" rx="6" stroke="currentColor"/>
              <path d="M18 28h28" stroke="currentColor"/>
              <circle cx="46" cy="20" r="3" fill="currentColor"/>
              <circle cx="50" cy="14" r="2" fill="currentColor"/>
            </svg>
          </div>
        </div>
      </div>
    </section>

    <!-- COURSES -->
    <section class="screen" id="screen-courses">
      <div class="sectionTitle">–ö—É—Ä—Å—ã</div>
      <div id="coursesRoot"></div>
    </section>

    <!-- PROGRESS -->
    <section class="screen" id="screen-progress">
      <div class="sectionTitle">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
      <div class="glass" style="padding:14px">
        <div class="muted small">–°–µ–π—á–∞—Å –ø—Ä–æ–≥—Ä–µ—Å—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –ü–æ—Ç–æ–º –ø—Ä–∏–≤—è–∂–µ–º –∫ Telegram ID –∏ —Å–µ—Ä–≤–µ—Ä—É.</div>
      </div>
      <div style="height:10px"></div>
      <div id="progressRoot"></div>
    </section>

    <!-- BONUS -->
    <section class="screen" id="screen-bonus">
      <div class="sectionTitle">–ë–æ–Ω—É—Å—ã</div>
      <div id="bonusRoot"></div>
    </section>

    <!-- SUPPORT -->
    <section class="screen" id="screen-support">
      <div class="sectionTitle">–°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ</div>
      <div id="supportRoot"></div>
    </section>

    <!-- PROFILE -->
    <section class="screen" id="screen-profile">
      <div class="sectionTitle">–ü—Ä–æ—Ñ–∏–ª—å</div>
      <div id="profileRoot"></div>
    </section>
  </div>

  <!-- bottom nav -->
  <div class="nav">
    <div class="navInner">
      <button class="nav__item is-active" data-tab="home" title="–ì–ª–∞–≤–Ω–∞—è">
        <svg viewBox="0 0 64 64" fill="none">
          <path d="M12 30l20-16 20 16v22H12V30z" stroke="currentColor" stroke-linejoin="round"/>
        </svg>
        –ì–ª–∞–≤–Ω–∞—è
      </button>
      <button class="nav__item" data-tab="courses" title="–ö—É—Ä—Å—ã">
        <svg viewBox="0 0 64 64" fill="none">
          <rect x="14" y="16" width="36" height="32" rx="6" stroke="currentColor"/>
          <path d="M22 26h20M22 34h20" stroke="currentColor" stroke-linecap="round"/>
        </svg>
        –ö—É—Ä—Å—ã
      </button>
      <button class="nav__item" data-tab="progress" title="–ü—Ä–æ–≥—Ä–µ—Å—Å">
        <svg viewBox="0 0 64 64" fill="none">
          <circle cx="32" cy="32" r="18" stroke="currentColor"/>
          <path d="M32 20v12l8 6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        –ü—Ä–æ–≥—Ä–µ—Å—Å
      </button>
      <button class="nav__item" data-tab="bonus" title="–ë–æ–Ω—É—Å—ã">
        <svg viewBox="0 0 64 64" fill="none">
          <path d="M32 10l6 12 14 2-10 10 2 14-12-6-12 6 2-14-10-10 14-2 6-12z"
                stroke="currentColor" stroke-linejoin="round"/>
        </svg>
        –ë–æ–Ω—É—Å—ã
      </button>
      <button class="nav__item" data-tab="profile" title="–ü—Ä–æ—Ñ–∏–ª—å">
        <svg viewBox="0 0 64 64" fill="none">
          <circle cx="32" cy="24" r="8" stroke="currentColor"/>
          <path d="M16 46c0-8 32-8 32 0" stroke="currentColor" stroke-linecap="round"/>
        </svg>
        –ü—Ä–æ—Ñ–∏–ª—å
      </button>
    </div>
  </div>

  <script>
    /***********************
     * MR Detailing Academy
     * Single-file stable build
     ***********************/
    const tg = window.Telegram?.WebApp;

    // === SET YOUR ADMIN TG ID HERE ===
    // get it via @userinfobot
    const ADMIN_TG_IDS = new Set([
      340616352 // <-- CHANGE THIS
    ]);

    const $ = (q) => document.querySelector(q);
    const $$ = (q) => Array.from(document.querySelectorAll(q));

    function popup(title, message){
      if (tg?.showPopup) tg.showPopup({ title, message, buttons:[{type:"ok"}] });
      else alert(title + "\n\n" + message);
    }

    function nowGreeting(){
      const h = new Date().getHours();
      if (h < 12) return "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ,";
      if (h < 18) return "–î–æ–±—Ä—ã–π –¥–µ–Ω—å,";
      return "–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä,";
    }

    function getTelegramUserId(){
      const u = tg?.initDataUnsafe?.user;
      return u?.id ? Number(u.id) : null;
    }
    function isAdmin(){
      const id = getTelegramUserId();
      return id != null && ADMIN_TG_IDS.has(id);
    }

    // ===== data =====
    const academy = {
      courses: [
        {
          id:"wash", free:true,
          title:"–ö—É—Ä—Å –º–æ–π–∫–∏",
          desc:"–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –±–∞–∑–∞. –û—Ç–∫—Ä–æ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–ª–∞—Ç–Ω—ã–º –∫—É—Ä—Å–∞–º.",
          icon:"wash",
          modules:[
            { id:"wash_m1", title:"–ú–æ–¥—É–ª—å 1 ‚Äî –û—Å–Ω–æ–≤—ã", lessons:[
              { id:"wash_l1", title:"–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–µ—Ç–µ–π–ª–∏–Ω–≥", text:
`–î–µ—Ç–µ–π–ª–∏–Ω–≥ ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–π —É—Ö–æ–¥ –∑–∞ –∞–≤—Ç–æ: –æ—á–∏—Å—Ç–∫–∞ + –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ + –∑–∞—â–∏—Ç–∞.
–¶–µ–ª—å: —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è.`,
                test:{ q:"–î–µ—Ç–µ–π–ª–∏–Ω–≥ ‚Äî —ç—Ç–æ‚Ä¶", options:[
                  "–ü—Ä–æ—Å—Ç–æ –º–æ–π–∫–∞ —Å –ø–µ–Ω–æ–π",
                  "–°–∏—Å—Ç–µ–º–Ω—ã–π —É—Ö–æ–¥: –æ—á–∏—Å—Ç–∫–∞ + –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ + –∑–∞—â–∏—Ç–∞",
                  "–¢–æ–ª—å–∫–æ –ø–æ–ª–∏—Ä–æ–≤–∫–∞"
                ], correct:1, explain:"–î–µ—Ç–µ–π–ª–∏–Ω–≥ –≤–∫–ª—é—á–∞–µ—Ç –æ—á–∏—Å—Ç–∫—É, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –∑–∞—â–∏—Ç—É." }
              },
              { id:"wash_l2", title:"–û—à–∏–±–∫–∏ –Ω–æ–≤–∏—á–∫–æ–≤", text:
`–û—à–∏–±–∫–∏:
1) –û–¥–Ω–∞ –≥—É–±–∫–∞ –Ω–∞ –≤—Å—ë ‚Üí –º–∏–∫—Ä–æ—Ü–∞—Ä–∞–ø–∏–Ω—ã
2) –ú–æ–π–∫–∞ –ø–æ —Å—É—Ö–æ–π –ø—ã–ª–∏
3) –°–∏–ª—å–Ω–∞—è —Ö–∏–º–∏—è –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è
4) –ü–ª–æ—Ö–∞—è —Å—É—à–∫–∞ ‚Üí —Ä–∞–∑–≤–æ–¥—ã`,
                test:{ q:"–ß—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç –º–∏–∫—Ä–æ—Ü–∞—Ä–∞–ø–∏–Ω—ã?", options:[
                  "–û–¥–Ω–∞ –≥—É–±–∫–∞/—Ç—Ä—è–ø–∫–∞ –Ω–∞ –≤—Å—ë",
                  "–†–∞–∑–¥–µ–ª—å–Ω—ã–µ –≤–µ–¥—Ä–∞ –∏ –º–∏–∫—Ä–æ—Ñ–∏–±—Ä—ã",
                  "–°—É—à–∫–∞ –≤–æ–∑–¥—É—Ö–æ–º"
                ], correct:0, explain:"–û–¥–Ω–∞ –≥—É–±–∫–∞ —Å–æ–±–∏—Ä–∞–µ—Ç –∞–±—Ä–∞–∑–∏–≤ –∏ —Ü–∞—Ä–∞–ø–∞–µ—Ç –õ–ö–ü." }
              }
            ]},
            { id:"wash_m2", title:"–ú–æ–¥—É–ª—å 2 ‚Äî –ü—Ä–æ—Ü–µ—Å—Å", lessons:[
              { id:"wash_l3", title:"–î–≤—É—Ö—Ñ–∞–∑–Ω–∞—è –º–æ–π–∫–∞", text:
`–§–∞–∑–∞ 1: –±–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç ‚Äî —Å–Ω–∏–º–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é –≥—Ä—è–∑—å.
–§–∞–∑–∞ 2: –∫–æ–Ω—Ç–∞–∫—Ç ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–æ–º—ã–≤–∞–µ—Ç.
–ü—Ä–∞–≤–∏–ª–æ: –∫–æ–Ω—Ç–∞–∫—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –±–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç–∞.`,
                test:{ q:"–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –ø–µ—Ä–≤–∞—è —Ñ–∞–∑–∞?", options:[
                  "–ß—Ç–æ–±—ã —Å–Ω—è—Ç—å –≥—Ä—è–∑—å –∏ —Å–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫ —Ü–∞—Ä–∞–ø–∏–Ω",
                  "–ß—Ç–æ–±—ã –≤—ã—Å—É—à–∏—Ç—å –∫—É–∑–æ–≤",
                  "–ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ –ø–µ—Ä–µ–π—Ç–∏ –∫ –∫–æ–Ω—Ç–∞–∫—Ç—É"
                ], correct:0, explain:"–§–∞–∑–∞ 1 —Å–Ω–∏–º–∞–µ—Ç –≥—Ä—è–∑—å ‚Äî –º–µ–Ω—å—à–µ –∞–±—Ä–∞–∑–∏–≤–∞ –ø—Ä–∏ –∫–æ–Ω—Ç–∞–∫—Ç–µ." }
              }
            ]}
          ]
        },

        { id:"interior", free:false, title:"–•–∏–º—á–∏—Å—Ç–∫–∞ —Å–∞–ª–æ–Ω–∞",
          desc:"–ü–æ–∫—É–ø–∫–∞/–ø–æ–¥–ø–∏—Å–∫–∞. ‚Äì50% –∑–∞ 3 –¥—Ä—É–∑–µ–π.",
          icon:"interior",
          modules:[
            { id:"int_m1", title:"–ú–æ–¥—É–ª—å 1 ‚Äî –ú–∞—Ç–µ—Ä–∏–∞–ª—ã", lessons:[
              { id:"int_l1", title:"–¢–∫–∞–Ω—å vs –∫–æ–∂–∞", text:
`–¢–∫–∞–Ω—å: –≤–ø–∏—Ç—ã–≤–∞–µ—Ç ‚Üí –≤–∞–∂–Ω–∞ —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—è.
–ö–æ–∂–∞: –Ω–µ–ª—å–∑—è –∑–∞–ª–∏–≤–∞—Ç—å/–ø–µ—Ä–µ—Å—É—à–∏–≤–∞—Ç—å ‚Üí –º—è–≥–∫–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ + –∑–∞—â–∏—Ç–∞.`,
                test:{ q:"–ß—Ç–æ –æ–ø–∞—Å–Ω–µ–µ –≤—Å–µ–≥–æ –¥–ª—è –∫–æ–∂–∏?", options:[
                  "–ú—è–≥–∫–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ –∏ –∑–∞—â–∏—Ç–∞",
                  "–°–∏–ª—å–Ω–∞—è —â—ë–ª–æ—á—å –∏ –∑–∞–ª–∏–≤ –≤–æ–¥–æ–π",
                  "–õ—ë–≥–∫–∞—è –≤–ª–∞–∂–Ω–∞—è –ø—Ä–æ—Ç–∏—Ä–∫–∞"
                ], correct:1, explain:"–°–∏–ª—å–Ω–∞—è —Ö–∏–º–∏—è –∏ –≤–æ–¥–∞ –º–æ–≥—É—Ç –ø–æ–≤—Ä–µ–¥–∏—Ç—å –∫–æ–∂—É –∏ —à–≤—ã." }
              }
            ]}
          ]
        },

        { id:"polish", free:false, title:"–ü–æ–ª–∏—Ä–æ–≤–∫–∞",
          desc:"–¢–µ—Ö–Ω–∏–∫–∞, –∫—Ä—É–≥–∏, –ø–∞—Å—Ç—ã, —ç—Ç–∞–ø—ã. PRO-–¥–æ—Å—Ç—É–ø.",
          icon:"polish",
          modules:[
            { id:"pol_m1", title:"–ú–æ–¥—É–ª—å 1 ‚Äî –¢–µ–æ—Ä–∏—è", lessons:[
              { id:"pol_l1", title:"–ó–∞—á–µ–º –ø–æ–ª–∏—Ä–æ–≤–∫–∞", text:
`–ü–æ–ª–∏—Ä–æ–≤–∫–∞ ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Å–ª–æ—è –ª–∞–∫–∞ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥–µ—Ñ–µ–∫—Ç–æ–≤.
–ù–∞—á–∏–Ω–∞–π —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π —Å–≤—è–∑–∫–∏.`,
                test:{ q:"–° —á–µ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å?", options:[
                  "–° –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∂—ë—Å—Ç–∫–æ–π –ø–∞—Å—Ç—ã",
                  "–° –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π —Å–≤—è–∑–∫–∏",
                  "–° –Ω–∞–∂–¥–∞—á–∫–∏ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ"
                ], correct:1, explain:"–ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–≥—Ä–µ—Å—Å–∏—è, –∑–∞—Ç–µ–º —É—Å–∏–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏." }
              }
            ]}
          ]
        },

        { id:"protect", free:false, title:"–ó–∞—â–∏—Ç–∞",
          desc:"–ö–µ—Ä–∞–º–∏–∫–∞/–≤–æ—Å–∫/—Å–∏–ª–∞–µ–Ω—Ç—ã: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –Ω–∞–Ω–µ—Å–µ–Ω–∏–µ.",
          icon:"protect",
          modules:[
            { id:"pr_m1", title:"–ú–æ–¥—É–ª—å 1 ‚Äî –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞", lessons:[
              { id:"pr_l1", title:"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–¥ –∑–∞—â–∏—Ç—É", text:
`–õ—é–±–∞—è –∑–∞—â–∏—Ç–∞ –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ:
–º–æ–π–∫–∞ ‚Üí –¥–µ–∫–æ–Ω—Ç–∞–º–∏–Ω–∞—Ü–∏—è ‚Üí –æ–±–µ–∑–∂–∏—Ä–∏–≤–∞–Ω–∏–µ ‚Üí –Ω–∞–Ω–µ—Å–µ–Ω–∏–µ ‚Üí –≤—ã–¥–µ—Ä–∂–∫–∞.`,
                test:{ q:"–ö–ª—é—á –∫ —Å—Ç–æ–π–∫–æ—Å—Ç–∏ –∑–∞—â–∏—Ç—ã?", options:[
                  "–¢–æ–ª—å–∫–æ –±—Ä–µ–Ω–¥ —Å–æ—Å—Ç–∞–≤–∞",
                  "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏",
                  "–°–æ–ª–Ω–µ—á–Ω–∞—è –ø–æ–≥–æ–¥–∞"
                ], correct:1, explain:"–°—Ç–æ–π–∫–æ—Å—Ç—å = –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ + –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è." }
              }
            ]}
          ]
        }
      ]
    };

    // ===== storage =====
    const state = {
      tab:"home",
      progress: JSON.parse(localStorage.getItem("mr_progress") || "{}")
    };
    function save(){ localStorage.setItem("mr_progress", JSON.stringify(state.progress)); }
    function setP(k,v){ state.progress[k]=v; save(); }
    function getP(k){ return !!state.progress[k]; }

    function courseLessons(course){
      return course.modules.flatMap(m => m.lessons.map(l => ({...l, moduleId:m.id, moduleTitle:m.title})));
    }
    function coursePercent(courseId){
      const c = academy.courses.find(x=>x.id===courseId);
      if(!c) return 0;
      const lessons = courseLessons(c);
      const done = lessons.filter(l => getP(`lesson_${courseId}_${l.id}_done`)).length;
      return Math.round((done/lessons.length)*100);
    }
    function markLessonDone(courseId, lessonId){
      setP(`lesson_${courseId}_${lessonId}_done`, true);
      if (coursePercent(courseId) === 100) setP(`course_${courseId}_done`, true);
      if (courseId === "wash" && coursePercent(courseId) === 100) setP("course_wash_done", true);
    }

    // ===== access rules =====
    function isCourseLocked(course){
      if (isAdmin()) return false;      // only you have full access
      if (course.free) return false;    // free open
      return true;                      // paid locked (we'll connect Stars later)
    }

    // ===== icon svgs =====
    function svgRight(kind){
      if (kind==="wash") return `
        <svg viewBox="0 0 64 64" fill="none">
          <path d="M12 38h40l-4 10H16l-4-10z" stroke="currentColor"/>
          <path d="M18 38l6-14h16l6 14" stroke="currentColor"/>
          <path d="M24 18c0 4-4 6-4 10" stroke="currentColor" stroke-linecap="round"/>
          <path d="M40 18c0 4 4 6 4 10" stroke="currentColor" stroke-linecap="round"/>
        </svg>`;
      if (kind==="interior") return `
        <svg viewBox="0 0 64 64" fill="none">
          <rect x="18" y="14" width="28" height="30" rx="6" stroke="currentColor"/>
          <path d="M18 28h28" stroke="currentColor"/>
          <circle cx="46" cy="20" r="3" fill="currentColor"/>
          <circle cx="50" cy="14" r="2" fill="currentColor"/>
        </svg>`;
      if (kind==="polish") return `
        <svg viewBox="0 0 64 64" fill="none">
          <rect x="10" y="26" width="36" height="12" rx="6" stroke="currentColor"/>
          <circle cx="48" cy="32" r="6" stroke="currentColor"/>
          <path d="M20 44h24" stroke="currentColor" stroke-linecap="round"/>
        </svg>`;
      return `
        <svg viewBox="0 0 64 64" fill="none">
          <path d="M32 10l18 6v14c0 12-8 18-18 24-10-6-18-12-18-24V16l18-6z" stroke="currentColor"/>
          <path d="M24 30l6 6 10-12" stroke="currentColor" stroke-linecap="round"/>
        </svg>`;
    }

    // ===== navigation =====
    function showTab(tab){
      state.tab = tab;

      $$(".screen").forEach(s => s.classList.remove("is-active"));
      const target = $("#screen-" + tab);
      (target || $("#screen-home"))?.classList.add("is-active");

      $$(".nav__item").forEach(b => b.classList.remove("is-active"));
      $(`.nav__item[data-tab="${tab}"]`)?.classList.add("is-active");

      if (tab==="courses") renderCoursesList();
      if (tab==="progress") renderProgress();
      if (tab==="bonus") renderBonus();
      if (tab==="support") renderSupport();
      if (tab==="profile") renderProfile();
    }

    function bindNav(){
      $$(".nav__item").forEach(btn => btn.addEventListener("click", ()=>showTab(btn.dataset.tab)));
      $$("[data-go]").forEach(btn => btn.addEventListener("click", ()=>showTab(btn.dataset.go)));

      $("#homeStartWash")?.addEventListener("click", ()=>{
        showTab("courses");
        renderCourseDetail("wash");
      });
      $("#homeAllCourses")?.addEventListener("click", ()=>showTab("courses"));
      $("#homeGoCourses")?.addEventListener("click", ()=>showTab("courses"));
      $("#homeGoBonus")?.addEventListener("click", ()=>showTab("bonus"));
    }

    // ===== render: courses =====
    function renderCoursesList(){
      const root = $("#coursesRoot");
      if (!root) return;
      root.innerHTML = "";

      academy.courses.forEach(course=>{
        const locked = isCourseLocked(course);
        const pct = coursePercent(course.id);

        const el = document.createElement("div");
        el.className = `courseCard ${locked ? "locked" : "free"}`;
        el.innerHTML = `
          <div class="rightIcon">${svgRight(course.icon)}</div>

          <div class="badge ${locked ? "lock" : "ok"}">${locked ? "LOCKED" : (course.free ? "FREE" : "PRO")} ‚Ä¢ ${pct}%</div>
          <div class="courseTitle">${course.title}</div>
          <div class="courseDesc">${course.desc}</div>

          <div class="progressLine"><i style="width:${pct}%"></i></div>

          <div class="courseActions">
            <button class="btn ${locked ? "btn--ghost" : "btn--primary"}" data-open-course="${course.id}">
              ${locked ? "üîí –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ" : "–û—Ç–∫—Ä—ã—Ç—å"}
            </button>
            <button class="btn btn--ghost" data-preview-course="${course.id}">–û–ø–∏—Å–∞–Ω–∏–µ</button>
          </div>
        `;
        root.appendChild(el);
      });

      $$("[data-open-course]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.dataset.openCourse;
          const course = academy.courses.find(c=>c.id===id);
          if (!course) return;
          if (isCourseLocked(course)) return popup("–ó–∞–∫—Ä—ã—Ç–æ", "–ü–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å. –î–æ—Å—Ç—É–ø –æ—Ç–∫—Ä–æ–µ–º —á–µ—Ä–µ–∑ Telegram Stars/–ø–æ–¥–ø–∏—Å–∫—É (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥).");
          renderCourseDetail(id);
        });
      });

      $$("[data-preview-course]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.dataset.previewCourse;
          const course = academy.courses.find(c=>c.id===id);
          if (course) popup(course.title, course.desc);
        });
      });
    }

    function renderCourseDetail(courseId){
      const root = $("#coursesRoot");
      const course = academy.courses.find(c=>c.id===courseId);
      if (!root || !course) return;

      root.innerHTML = `
        <div class="glass" style="padding:14px">
          <div style="display:flex; justify-content:space-between; gap:12px; align-items:center">
            <div>
              <div style="font-weight:950; font-size:18px">${course.title}</div>
              <div class="muted small" style="margin-top:4px">${course.desc}</div>
              <div class="muted small" style="margin-top:6px">–ü—Ä–æ–≥—Ä–µ—Å—Å: <b>${coursePercent(courseId)}%</b></div>
            </div>
            <button class="btn btn--ghost" id="backCourses">‚Üê –ù–∞–∑–∞–¥</button>
          </div>
        </div>
        <div style="height:10px"></div>
      `;

      course.modules.forEach(m=>{
        const block = document.createElement("div");
        block.className = "glass";
        block.style.padding = "14px";
        block.style.marginTop = "12px";
        block.innerHTML = `
          <div style="display:flex;justify-content:space-between;gap:12px;align-items:center">
            <div style="font-weight:950">${m.title}</div>
            <span class="badge lock">${m.lessons.length} —É—Ä–æ–∫(–∞)</span>
          </div>
          <div class="hr"></div>
          ${m.lessons.map(l=>{
            const done = getP(\`lesson_${courseId}_${l.id}_done\`);
            return `
              <div class="item" style="margin-top:10px">
                <div>
                  <div style="font-weight:900">${l.title}</div>
                  <div class="muted small">${done ? "‚úÖ –ø—Ä–æ–π–¥–µ–Ω–æ" : "üü° –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–æ"}</div>
                </div>
                <button class="btn btn--primary" data-open-lesson="${courseId}|${m.id}|${l.id}">–û—Ç–∫—Ä—ã—Ç—å</button>
              </div>`;
          }).join("")}
        `;
        root.appendChild(block);
      });

      $("#backCourses")?.addEventListener("click", renderCoursesList);
      $$("[data-open-lesson]").forEach(b=>{
        b.addEventListener("click", ()=>{
          const [cId,mId,lId] = b.dataset.openLesson.split("|");
          renderLesson(cId,mId,lId);
        });
      });
    }

    function renderLesson(courseId, moduleId, lessonId){
      const root = $("#coursesRoot");
      const course = academy.courses.find(c=>c.id===courseId);
      const mod = course?.modules.find(m=>m.id===moduleId);
      const lesson = mod?.lessons.find(l=>l.id===lessonId);
      if(!root || !lesson) return;

      root.innerHTML = `
        <div class="glass" style="padding:14px">
          <div style="display:flex;justify-content:space-between;gap:12px;align-items:center">
            <div>
              <div style="font-weight:950">${course.title}</div>
              <div class="muted small" style="margin-top:4px">${mod.title}</div>
            </div>
            <button class="btn btn--ghost" id="backToModules">‚Üê –ö –º–æ–¥—É–ª—è–º</button>
          </div>
          <div class="hr"></div>
          <div style="font-weight:950; font-size:18px">${lesson.title}</div>
          <div class="muted" style="white-space:pre-line; margin-top:8px; line-height:1.45">${lesson.text}</div>
          <div class="hr"></div>
          <button class="btn btn--primary" id="startTest">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</button>
        </div>
      `;

      $("#backToModules")?.addEventListener("click", ()=>renderCourseDetail(courseId));
      $("#startTest")?.addEventListener("click", ()=>renderTest(courseId,moduleId,lessonId));
    }

    function renderTest(courseId, moduleId, lessonId){
      const root = $("#coursesRoot");
      const course = academy.courses.find(c=>c.id===courseId);
      const mod = course?.modules.find(m=>m.id===moduleId);
      const lesson = mod?.lessons.find(l=>l.id===lessonId);
      const test = lesson?.test;
      if(!root || !test) return;

      root.innerHTML = `
        <div class="glass" style="padding:14px">
          <div style="display:flex;justify-content:space-between;gap:12px;align-items:center">
            <div style="font-weight:950">–¢–µ—Å—Ç</div>
            <button class="btn btn--ghost" id="backLesson">‚Üê –ö —É—Ä–æ–∫—É</button>
          </div>
          <div class="hr"></div>
          <div style="font-weight:950; font-size:18px">${test.q}</div>
          <div id="opts" style="margin-top:12px; display:grid; gap:10px"></div>
          <div class="hr"></div>
          <div class="muted small">–í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>
      `;

      $("#backLesson")?.addEventListener("click", ()=>renderLesson(courseId,moduleId,lessonId));

      const opts = $("#opts");
      test.options.forEach((t,idx)=>{
        const b = document.createElement("button");
        b.className = "btn btn--ghost";
        b.style.justifyContent = "flex-start";
        b.textContent = t;
        b.addEventListener("click", ()=>{
          if (idx === test.correct){
            markLessonDone(courseId, lessonId);
            popup("‚úÖ –°–¥–∞–Ω–æ", test.explain);
            renderCourseDetail(courseId);
          } else {
            popup("‚ùå –ù–µ —Å–¥–∞–Ω–æ", "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–æ–≤—Ç–æ—Ä–∏ —É—Ä–æ–∫ –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.\n\n" + test.explain);
            renderLesson(courseId,moduleId,lessonId);
          }
        });
        opts.appendChild(b);
      });
    }

    // ===== render: progress =====
    function renderProgress(){
      const root = $("#progressRoot");
      if(!root) return;
      root.innerHTML = "";

      academy.courses.forEach(c=>{
        const pct = coursePercent(c.id);
        const locked = isCourseLocked(c);
        const el = document.createElement("div");
        el.className = "item";
        el.style.marginTop = "10px";
        el.innerHTML = `
          <div>
            <div style="font-weight:950">${c.title}</div>
            <div class="muted small">${locked ? "üîí –∑–∞–∫—Ä—ã—Ç" : (pct===100 ? "‚úÖ –ø—Ä–æ–π–¥–µ–Ω" : "üü° –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ")}</div>
          </div>
          <span class="badge ${locked ? "lock" : "ok"}">${pct}%</span>
        `;
        root.appendChild(el);
      });

      const reset = document.createElement("button");
      reset.className = "btn btn--ghost";
      reset.style.marginTop = "12px";
      reset.textContent = "–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å";
      reset.addEventListener("click", ()=>{
        state.progress = {};
        save();
        popup("–ì–æ—Ç–æ–≤–æ", "–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω.");
        renderProgress();
      });
      root.appendChild(reset);
    }

    // ===== render: bonus =====
    function renderBonus(){
      const root = $("#bonusRoot");
      if(!root) return;
      root.innerHTML = `
        <div class="glass" style="padding:14px">
          <div class="item">
            <div>
              <div style="font-weight:950">–†–µ—Ñ–µ—Ä–∞–ª—ã</div>
              <div class="muted small">–ü—Ä–∏–≤–µ–¥–∏ 3 –¥—Ä—É–∑–µ–π ‚Äî –ø–æ–ª—É—á–∏ ‚Äì50% –Ω–∞ –•–∏–º—á–∏—Å—Ç–∫—É (–ø–æ–¥–∫–ª—é—á–∏–º –ø–æ—Å–ª–µ Stars)</div>
            </div>
            <span class="badge lock">—Å–∫–æ—Ä–æ</span>
          </div>
          <div style="height:10px"></div>
          <div class="item">
            <div>
              <div style="font-weight:950">–ü–∞–∫–µ—Ç—ã</div>
              <div class="muted small">–ö—É—Ä—Å—ã / –°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ / –ö–æ–º–ø–ª–µ–∫—Å —Å–æ —Å–∫–∏–¥–∫–æ–π</div>
            </div>
            <span class="badge lock">—Å–∫–æ—Ä–æ</span>
          </div>
        </div>
      `;
    }

    // ===== support logic =====
    function boughtCoursesCount(){
      // –ü–æ–∫–∞ MVP: —Å—á–∏—Ç–∞–µ–º –∫—É–ø–ª–µ–Ω–Ω—ã–º–∏ —Ç–µ, –≥–¥–µ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ course_{id}_purchased
      // (–∫–æ–≥–¥–∞ –ø–æ–¥–∫–ª—é—á–∏–º Stars ‚Äî –±—É–¥–µ–º —Å—Ç–∞–≤–∏—Ç—å —ç—Ç–∏ —Ñ–ª–∞–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã)
      return academy.courses.filter(c => getP(`course_${c.id}_purchased`)).length;
    }
    function hasSupportAccess(){
      if (isAdmin()) return true;
      const forever = boughtCoursesCount() >= 3;
      const sub = getP("support_sub_active"); // –ø–æ–∑–∂–µ –ø—Ä–∏–≤—è–∂–µ–º –∫ Stars subscription
      return forever || sub;
    }

    function renderSupport(){
      const root = $("#supportRoot");
      if(!root) return;

      const access = hasSupportAccess();
      root.innerHTML = `
        <div class="glass" style="padding:14px">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
            <div>
              <div style="font-weight:950; font-size:18px">–ß–∞—Ç—ã –∏ –ø–æ–º–æ—â—å</div>
              <div class="muted small" style="margin-top:6px">
                –î–æ—Å—Ç—É–ø: –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –º–µ—Å—è—Ü (Stars) <b>–∏–ª–∏</b> –Ω–∞–≤—Å–µ–≥–¥–∞, –µ—Å–ª–∏ –∫—É–ø–ª–µ–Ω–æ <b>3+ –∫—É—Ä—Å–∞</b>.
              </div>
              ${access ? `<div style="margin-top:10px"><span class="badge ok">–î–û–°–¢–£–ü –ï–°–¢–¨</span></div>` :
                         `<div style="margin-top:10px"><span class="badge lock">–ù–£–ñ–ï–ù –î–û–°–¢–£–ü</span></div>`}
            </div>
          </div>

          <div class="hr"></div>

          <div class="item">
            <div>
              <div style="font-weight:950">–ó–∞–∫—Ä—ã—Ç—ã–π —á–∞—Ç —É—á–µ–Ω–∏–∫–æ–≤</div>
              <div class="muted small">–†–∞–∑–±–æ—Ä—ã, –∫–µ–π—Å—ã, —Å–æ–≤–µ—Ç—ã, –ø–æ–¥–¥–µ—Ä–∂–∫–∞</div>
            </div>
            <span class="badge ${access ? "ok" : "lock"}">${access ? "OPEN" : "PRO"}</span>
          </div>

          <div style="height:10px"></div>

          <div class="item">
            <div>
              <div style="font-weight:950">–ß–∞—Ç —Å –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–º</div>
              <div class="muted small">–í–æ–ø—Ä–æ—Å—ã –ø–æ —Ä–∞–±–æ—Ç–∞–º, –ø–æ–¥–±–æ—Ä —Ö–∏–º–∏–∏, —Ä–∞–∑–±–æ—Ä –æ—à–∏–±–æ–∫</div>
            </div>
            <span class="badge ${access ? "ok" : "lock"}">${access ? "OPEN" : "PRO"}</span>
          </div>

          <div class="hr"></div>

          <div style="display:grid; gap:10px">
            <button class="btn btn--primary" id="supportBuy">${access ? "–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç" : "–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É (—Å–∫–æ—Ä–æ Stars)"}</button>
            <button class="btn btn--ghost" id="supportForever">–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞?</button>
          </div>
        </div>
      `;

      $("#supportBuy")?.addEventListener("click", ()=>{
        if (access){
          popup("–ß–∞—Ç—ã", "Comming Soon");
        } else {
          popup("–°–∫–æ—Ä–æ", "–ü–æ–¥–∫–ª—é—á–∏–º Telegram Stars –∏ —Å–¥–µ–ª–∞–µ–º –ø–æ–¥–ø–∏—Å–∫—É/Comming Soon");
        }
      });

      $("#supportForever")?.addEventListener("click", ()=>{
        popup("–ù–∞–≤—Å–µ–≥–¥–∞", "–ù–∞–≤—Å–µ–≥–¥–∞ –≤—ã–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –∫—É–ø–ª–µ–Ω–æ 3+ –∫—É—Ä—Å–∞. –ü–æ—Å–ª–µ Stars —ç—Ç–æ –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.");
      });
    }

    // ===== profile =====
    function renderProfile(){
      const root = $("#profileRoot");
      if(!root) return;

      const uid = getTelegramUserId();
      root.innerHTML = `
        <div class="glass" style="padding:14px">
          <div class="item">
            <div>
              <div style="font-weight:950">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
              <div class="muted small" style="margin-top:4px">${$("#username")?.textContent || "User"}</div>
              <div class="muted small" style="margin-top:4px">TG ID: <b>${uid ?? "–Ω–µ—Ç (–±—Ä–∞—É–∑–µ—Ä)"}</b></div>
              ${isAdmin() ? `<div style="margin-top:10px"><span class="badge ok">ADMIN MODE</span></div>` : ``}
            </div>
            <span class="badge ok">OK</span>
          </div>

          <div class="hr"></div>

          <div style="display:grid; gap:10px">
            <button class="btn btn--primary" id="goCourses">–û—Ç–∫—Ä—ã—Ç—å –∫—É—Ä—Å—ã</button>
            <button class="btn btn--ghost" id="goSupport">–°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ</button>
          </div>
        </div>
      `;

      $("#goCourses")?.addEventListener("click", ()=>showTab("courses"));
      $("#goSupport")?.addEventListener("click", ()=>showTab("support"));
    }

    // ===== init =====
    (function init(){
      $("#greeting").textContent = nowGreeting();

      if (tg){
        tg.ready();
        tg.expand();
        try{ tg.setHeaderColor?.("#0b0d12"); }catch(e){}
        try{ tg.setBackgroundColor?.("#0b0d12"); }catch(e){}
        const user = tg.initDataUnsafe?.user;
        if (user?.first_name) $("#username").textContent = user.first_name;
        $("#closeBtn")?.addEventListener("click", ()=>tg.close());
      } else {
        $("#closeBtn").style.display = "none";
      }

      bindNav();
      showTab("home");
    })();

  </script>
  <script>
  document.addEventListener('click', (e) => {
    const t = e.target.closest('button, a, [data-go], [data-tab]');
    if (t) {
      alert('CLICK OK: ' + (t.dataset.go || t.dataset.tab || t.id || t.className));
    }
  }, true);
</script>
</body>
</html>
